    {% extends 'base.html.twig' %}

{% block title %}Jeu du Pendu{% endblock %}

{% block stylesheets %}
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --neon-cyan: #0ff;
            --neon-magenta: #f0f;
            --neon-pink: #ff2a6d;
            --neon-yellow: #ffd300;
            --dark-bg: #0a0a12;
            --panel-bg: rgba(10, 10, 25, 0.85);
            --grid-color: rgba(0, 255, 255, 0.03);
        }

        body {
            font-family: 'Share Tech Mono', monospace;
            background: var(--dark-bg);
            color: #c8d6e5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background:
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,255,255,0.015) 2px, rgba(0,255,255,0.015) 4px),
                repeating-linear-gradient(90deg, transparent, transparent 50px, var(--grid-color) 50px, var(--grid-color) 51px),
                repeating-linear-gradient(0deg, transparent, transparent 50px, var(--grid-color) 50px, var(--grid-color) 51px);
            pointer-events: none;
            z-index: 0;
        }

        body::after {
            content: '';
            position: fixed;
            inset: 0;
            background: linear-gradient(transparent 50%, rgba(0,0,0,0.15) 50%);
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 9999;
            animation: scanlines 0.1s linear infinite;
        }

        @keyframes scanlines {
            0% { background-position: 0 0; }
            100% { background-position: 0 4px; }
        }

        .container {
            text-align: center;
            max-width: 650px;
            width: 100%;
            padding: 2rem;
            position: relative;
            z-index: 1;
            background: var(--panel-bg);
            border: 1px solid rgba(0, 255, 255, 0.15);
            border-radius: 4px;
            box-shadow:
                0 0 30px rgba(0, 255, 255, 0.07),
                inset 0 0 30px rgba(0, 255, 255, 0.03);
        }

        .container::before {
            content: '';
            position: absolute;
            top: -1px; left: -1px; right: -1px;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--neon-cyan), var(--neon-magenta), var(--neon-cyan), transparent);
            border-radius: 4px 4px 0 0;
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.2rem;
            font-weight: 900;
            margin-bottom: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 0.3rem;
            color: var(--neon-cyan);
            text-shadow:
                0 0 7px var(--neon-cyan),
                0 0 20px var(--neon-cyan),
                0 0 40px rgba(0, 255, 255, 0.4);
            animation: glitch-title 4s infinite;
            position: relative;
        }

        @keyframes glitch-title {
            0%, 92%, 100% { text-shadow: 0 0 7px var(--neon-cyan), 0 0 20px var(--neon-cyan), 0 0 40px rgba(0,255,255,0.4); }
            93% { text-shadow: -3px 0 var(--neon-magenta), 3px 0 var(--neon-cyan), 0 0 20px var(--neon-cyan); }
            94% { text-shadow: 3px 0 var(--neon-magenta), -3px 0 var(--neon-cyan), 0 0 20px var(--neon-magenta); }
            95% { text-shadow: 0 0 7px var(--neon-cyan), 0 0 20px var(--neon-cyan), 0 0 40px rgba(0,255,255,0.4); }
        }

        .hangman-drawing {
            font-size: 1.2rem;
            line-height: 1.4;
            margin-bottom: 1.5rem;
            white-space: pre;
            color: var(--neon-pink);
            text-shadow: 0 0 8px var(--neon-pink), 0 0 20px rgba(255, 42, 109, 0.4);
            transition: text-shadow 0.3s;
        }

        .word {
            font-size: 2.5rem;
            letter-spacing: 0.5rem;
            margin-bottom: 2rem;
        }
        .word span {
            display: inline-block;
            min-width: 1.5rem;
            border-bottom: 3px solid var(--neon-magenta);
            margin: 0 0.2rem;
            padding-bottom: 0.2rem;
            color: #fff;
            text-shadow: 0 0 10px var(--neon-magenta);
            box-shadow: 0 3px 8px rgba(255, 0, 255, 0.3);
            transition: all 0.2s;
        }

        .used-letters {
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
            color: #556;
        }
        .used-letters span {
            color: var(--neon-pink);
            font-weight: bold;
            text-shadow: 0 0 6px var(--neon-pink);
        }

        .keyboard {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.4rem;
            margin-bottom: 1.5rem;
        }
        .keyboard button {
            width: 2.5rem;
            height: 2.5rem;
            font-size: 1.1rem;
            font-family: 'Share Tech Mono', monospace;
            font-weight: bold;
            border: 1px solid rgba(0, 255, 255, 0.25);
            border-radius: 3px;
            background: rgba(0, 255, 255, 0.05);
            color: var(--neon-cyan);
            cursor: pointer;
            transition: all 0.15s;
            text-shadow: 0 0 4px var(--neon-cyan);
            position: relative;
        }
        .keyboard button:hover:not(:disabled) {
            background: rgba(0, 255, 255, 0.15);
            border-color: var(--neon-cyan);
            box-shadow: 0 0 12px rgba(0, 255, 255, 0.4), inset 0 0 12px rgba(0, 255, 255, 0.1);
            text-shadow: 0 0 8px var(--neon-cyan);
            transform: scale(1.1);
        }
        .keyboard button:disabled {
            opacity: 0.2;
            cursor: not-allowed;
        }
        .keyboard button.correct {
            background: rgba(0, 255, 100, 0.15);
            border-color: #0f6;
            color: #0f6;
            text-shadow: 0 0 6px #0f6;
            box-shadow: 0 0 8px rgba(0, 255, 100, 0.2);
            opacity: 0.8;
        }
        .keyboard button.wrong {
            background: rgba(255, 42, 109, 0.15);
            border-color: var(--neon-pink);
            color: var(--neon-pink);
            text-shadow: 0 0 6px var(--neon-pink);
            opacity: 0.4;
        }

        .info {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.85rem;
            color: #556;
            margin-bottom: 1rem;
            letter-spacing: 0.15rem;
            text-transform: uppercase;
        }

        .result {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            padding: 1.2rem;
            border-radius: 4px;
            letter-spacing: 0.1rem;
            text-transform: uppercase;
        }
        .result.won {
            background: rgba(0, 255, 100, 0.08);
            border: 1px solid rgba(0, 255, 100, 0.4);
            color: #0f6;
            text-shadow: 0 0 10px #0f6, 0 0 30px rgba(0, 255, 100, 0.3);
            box-shadow: 0 0 20px rgba(0, 255, 100, 0.1), inset 0 0 20px rgba(0, 255, 100, 0.05);
        }
        .result.lost {
            background: rgba(255, 42, 109, 0.08);
            border: 1px solid rgba(255, 42, 109, 0.4);
            color: var(--neon-pink);
            text-shadow: 0 0 10px var(--neon-pink), 0 0 30px rgba(255, 42, 109, 0.3);
            box-shadow: 0 0 20px rgba(255, 42, 109, 0.1), inset 0 0 20px rgba(255, 42, 109, 0.05);
            animation: lost-flicker 1.5s infinite;
        }

        @keyframes lost-flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.85; }
            52% { opacity: 1; }
            54% { opacity: 0.9; }
        }

        .new-game {
            display: inline-block;
            padding: 0.8rem 2.5rem;
            font-size: 1rem;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.15rem;
            background: transparent;
            color: var(--neon-cyan);
            border: 1px solid var(--neon-cyan);
            border-radius: 3px;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s;
            text-shadow: 0 0 6px var(--neon-cyan);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.15), inset 0 0 10px rgba(0, 255, 255, 0.05);
        }
        .new-game:hover {
            background: rgba(0, 255, 255, 0.1);
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.3), inset 0 0 25px rgba(0, 255, 255, 0.1);
            transform: scale(1.05);
        }

        .hint-btn {
            display: inline-block;
            padding: 0.5rem 1.5rem;
            font-size: 0.85rem;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1rem;
            background: transparent;
            color: var(--neon-yellow);
            border: 1px solid var(--neon-yellow);
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
            text-shadow: 0 0 6px var(--neon-yellow);
            box-shadow: 0 0 10px rgba(255, 211, 0, 0.1), inset 0 0 10px rgba(255, 211, 0, 0.03);
            margin-bottom: 1.5rem;
        }
        .hint-btn:hover {
            background: rgba(255, 211, 0, 0.1);
            box-shadow: 0 0 20px rgba(255, 211, 0, 0.25), inset 0 0 20px rgba(255, 211, 0, 0.08);
            transform: scale(1.05);
        }
        .hint-btn:disabled {
            opacity: 0.2;
            cursor: not-allowed;
            transform: none;
        }
    </style>
{% endblock %}

{% block body %}
    <div class="container">
        <h1>Jeu du Pendu</h1>
        {% if game.evil %}
            <p style="font-size: 0.75rem; color: var(--neon-pink); letter-spacing: 0.3rem; text-transform: uppercase; margin-top: -1rem; margin-bottom: 1.5rem; font-family: 'Orbitron', sans-serif; text-shadow: 0 0 6px var(--neon-pink);">// Mode Diabolique Active</p>
        {% else %}
            <p style="font-size: 0.75rem; color: #334; letter-spacing: 0.3rem; text-transform: uppercase; margin-top: -1rem; margin-bottom: 1.5rem; font-family: 'Orbitron', sans-serif;">// System v2.0 — Neural Link Active</p>
        {% endif %}

        {% set stages = [
            "  +---+\n  |   |\n      |\n      |\n      |\n      |\n=========",
            "  +---+\n  |   |\n  O   |\n      |\n      |\n      |\n=========",
            "  +---+\n  |   |\n  O   |\n  |   |\n      |\n      |\n=========",
            "  +---+\n  |   |\n  O   |\n /|   |\n      |\n      |\n=========",
            "  +---+\n  |   |\n  O   |\n /|\\  |\n      |\n      |\n=========",
            "  +---+\n  |   |\n  O   |\n /|\\  |\n /    |\n      |\n=========",
            "  +---+\n  |   |\n  O   |\n /|\\  |\n / \\  |\n      |\n========="
        ] %}

        <div class="hangman-drawing">{{ stages[game.tries] }}</div>

        <div class="word">
            {% for letter in game.maskedWord|split('') %}
                <span>{{ letter == '_' ? '&nbsp;' : letter }}</span>
            {% endfor %}
        </div>

        <div class="info">
            Essais : {{ game.tries }} / {{ game.maxTries }}
        </div>

        {% if game.status.value == 'won' %}
            <div class="result won">Bravo, vous avez trouve le mot !</div>
            <a href="{{ path('app_game_index') }}" class="new-game">Nouvelle partie</a>

        {% elseif game.status.value == 'lost' %}
            <div class="result lost">Perdu ! Le mot etait : {{ game.wordToGuess }}</div>
            <a href="{{ path('app_game_index') }}" class="new-game">Nouvelle partie</a>

        {% else %}
            {% if game.usedLetters|length > 0 %}
                <div class="used-letters">
                    Lettres incorrectes : <span>{{ game.usedLetters|join(', ') }}</span>
                </div>
            {% endif %}

            {% if not game.evil %}
                <form method="post" action="{{ path('app_game_hint') }}" style="display:block; margin-bottom: 0;">
                    <button type="submit" class="hint-btn" {% if game.hintUsage %}disabled{% endif %}>
                        {{ game.hintUsage ? '// Indice utilisé' : '? Indice' }}
                    </button>
                </form>
            {% endif %}

            <div class="keyboard">
                {% for letter in 'a'..'z' %}
                    {% if letter in game.guessedLetters %}
                        <button type="button" class="correct" disabled>{{ letter }}</button>
                    {% elseif letter in game.usedLetters %}
                        <button type="button" class="wrong" disabled>{{ letter }}</button>
                    {% else %}
                        <form method="post" action="{{ path('app_game_guess') }}" style="display:inline">
                            <input type="hidden" name="letter" value="{{ letter }}">
                            <button type="submit">{{ letter }}</button>
                        </form>
                    {% endif %}
                {% endfor %}
            </div>

            <a href="{{ path('app_game_index') }}" class="new-game" style="margin-top: 1.5rem; font-size: 0.75rem; padding: 0.5rem 1.5rem;">Menu</a>
        {% endif %}
    </div>
{% endblock %}
